import Link from "@docusaurus/Link";
import CodeBlock from "@theme/CodeBlock";

In this guide, we will go through the steps to set up a local development environment for building onchain
integrations with {props.protocol}. We will use Foundry to install {props.protocol} as a dependency, and run a simple test.

At the end, you’ll have a development environment set up that you can use to build the rest of the examples under
"Guides", or start your own integration project.

## Pre-requisites

You will need the following software on your machine:

- <Link href="https://git-scm.com/downloads">Git</Link>
- <Link href="https://github.com/foundry-rs/foundry">Foundry</Link>
- <Link href="https://nodejs.org/en/download">Node.js</Link>
- <Link href="https://bun.sh">Bun</Link>

In addition, familiarity with <Link href="https://ethereum.org/">Ethereum</Link> and <Link href="https://soliditylang.org/">Solidity</Link> is
requisite.

## Set up using integration template

:::tip

Make sure you are using the latest version of Foundry by running `foundryup`.

:::

We put together a template repository that you can use to get started quickly. This repository features a basic project
structure, pre-configured {props.protocol} imports, and a selection of sample contracts and tests.

To install the template, simply execute the following commands:

<CodeBlock language="bash">
  {`$ mkdir ${props.protocol.toLowerCase()}-integration-template
  $ cd ${props.protocol.toLowerCase()}-integration-template
  $ forge init --template sablier-labs/${props.protocol.toLowerCase()}-integration-template
  $ bun install`}
</CodeBlock>

Then, hop to the <Link href="#run-a-fork-test">Run a Fork Test</Link> section to complete your set up and start
developing.

## Set up using Foundry template

Foundry is a popular development toolkit for Ethereum projects, which we have used to build the {props.protocol} Protocol. For
the purposes of this guide, Foundry will provide us with the tooling needed to compile and test our contracts.

Let's use this command to spin up a new Foundry project:

```bash
$ forge init my-project
$ cd my-project
```

Once the initialization completes, take a look around at what got set up:

```bash
├── foundry.toml
├── script
├── src
└── test
```

The folder structure should be intuitive:

- `src` is where you'll write Solidity contracts
- `test` is where you'll write tests (also in Solidity)
- `script` is where you'll write scripts to perform actions like deploying contracts (you guessed it, in Solidity)
- `foundry.toml` is where you can configure your Foundry settings, which we will leave as is in this guide

:::note

You might notice that the CLI is `forge` rather than `foundry`. This is because Foundry is a toolkit, and `forge` is
just one of the tools that comes with it.

:::

## Install via npm package

Let's install the {props.protocol} Node.js packages using Bun:

<CodeBlock language="bash">
  {`$ mkdir ${props.protocol.toLowerCase()}-integration-template
  $ cd ${props.protocol.toLowerCase()}-integration-template
  $ forge init --template sablier-labs/${props.protocol.toLowerCase()}-integration-template
  $ bun install`}
</CodeBlock>

<CodeBlock language="bash">{`$ bun add @sablier/${props.protocol.toLowerCase()}`}</CodeBlock>

Bun will download the {props.protocol} contracts, along with their dependencies, and put them in the `node_modules` directory.

Let's remap the package names to point to the installed contracts. This step is required so that the Solidity
compiler can find the {props.protocol} contracts when you import them:

<CodeBlock language="bash">
  {`$ echo "@sablier/${props.protocol.toLowerCase()}=node_modules/@sablier/${props.protocol.toLowerCase()}/" >> remappings.txt
  $ echo "@openzeppelin/contracts/=node_modules/@openzeppelin/contracts/" >> remappings.txt
  $ echo "@prb/math/=node_modules/@prb/math/" >> remappings.txt`}
</CodeBlock>

That's it! You should now have a functional development environment to start building onchain {props.protocol}
integrations. Let's run a quick test to confirm everything is set up properly.

## Write your first contract

Delete the `src/Counter.sol` and `test/Counter.t.sol` files generated by Forge, and create two new files:
`src/StreamCreator.sol` and `test/StreamCreator.t.sol`.

Paste the following code into `src/StreamCreator.sol`:

<CodeBlock language="solidity" showLineNumbers metastring={`reference title="${props.protocol} Stream Creator"`}>
  {`https://github.com/sablier-labs/${props.protocol.toLowerCase()}-integration-template/blob/main/src/${props.protocol}StreamCreator.sol`}
</CodeBlock>

Let's use Forge to compile this contract:

```bash
$ forge build
```

If the contract was compiled correctly, you should see this message:

```bash
[⠢] Compiling...
[⠰] Compiling 62 files with Solc 0.8.26
[⠒] Solc 0.8.26 finished in 967.04ms
Compiler run successful!
```

:::info

The minimum Solidity version supported by the {props.protocol} contracts is v0.8.22.

:::

## Run a fork test

Foundry offers native support for running tests against a fork of Ethereum Mainnet, testnets and L2s, which is useful
when building and testing integrations with onchain protocols like Sablier. In practice, this enables you to access all
Sablier contracts deployed on Ethereum, and use them for testing your integration.

As a prerequisite, you will need an RPC that supports forking. A good solution for this is <Link href="https://alchemy.com/">Alchemy</Link>, as it includes forking in its free tier
plan.

Once you have obtained your RPC, you can proceed to run the following test:

<CodeBlock language="solidity" showLineNumbers metastring={`reference title="${props.protocol} Stream Creator Test"`}>
  {`https://github.com/sablier-labs/${props.protocol.toLowerCase()}-integration-template/blob/main/test/${props.protocol}StreamCreator.t.sol`}
</CodeBlock>

You can run the test using Forge:

```bash
$ forge test
```

If the test passed, you should see a message like this:

<CodeBlock language="bash">
  {`Ran 2 tests for test/${props.protocol}StreamCreator.t.sol:${props.protocol}StreamCreatorTest
[PASS] test_Create{props.protocol}Stream() (gas: 246830)
Suite result: ok. 1 passed; 0 failed; 0 skipped; finished in 626.58ms (500.67µs CPU time)`}
</CodeBlock>

## Next steps

Congratulations! Your environment is now configured, and you are prepared to start building. Explore the guides section
to discover various features available for {props.protocol} integration. Remember to include all contracts (`.sol` files) in the `src` folder and their corresponding tests in the `test` folder.

As far as Foundry is concerned, there is much more to uncover. If you want to learn more about it, check out the <Link href="https://book.getfoundry.sh/">Foundry Book</Link>, which contains numerous examples and
tutorials. A deep understanding of Foundry will enable you to create more sophisticated integrations with {props.protocol} protocol.
