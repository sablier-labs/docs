---
id: "stream-management"
sidebar_position: 4
title: "Stream Management"
---

import CodeBlock from "@theme/CodeBlock";
import HardcodedDemonstration from "../../../../src/snippets/_hardcoded-demonstration.mdx";
import CautionNonProduction from "../../../../src/snippets/_caution-non-production.mdx";

# Managing a Stream

This section will guide you through the different functions of Flow and how to interact with them. Before diving in,
please note the following:

1. We assume you are already familiar with [creating Flow streams](./03-create-stream.mdx).
2. We also assume that the stream management contract is authorized to invoke each respective function. To learn more
   about access control in Flow, see the [Access Control](/reference/flow/access-control) guide.

<CautionNonProduction />

# Set up your contract

Declare the Solidity version used to compile the contract:

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L1-L2`}
</CodeBlock>

Import the relevant symbols from `@sablier/flow` and `@prb/math`:

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L4-L5`}
</CodeBlock>

Declare the contract and add the Flow address as a constant:

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L7-L9`}
</CodeBlock>

<HardcodedDemonstration protocol="Flow" />

## Deposit

Depositing into streams means adding tokens to the stream, which will then be distributed to the recipient based on the
value of rate per second.

:::info

A deposit is also referred to as a top-up.

:::

There are three deposit functions:

1. [`deposit`](/reference/flow/contracts/contract.SablierFlow#deposit): deposits an amount of tokens.
2. [`depositAndPause`](/reference/flow/contracts/contract.SablierFlow#depositandpause): deposits an amount of tokens and
   then pauses the stream.

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L15-L21`}
</CodeBlock>

## Withdraw

The recipient of a stream can withdraw any amount, not exceeding the withdrawable amount. The recipient also has the
option to withdraw the tokens to an alternate address of their choice.

There are two withdrawal functions:

1. [`withdraw`](/reference/flow/contracts/contract.SablierFlow#withdraw): withdraws an amount of tokens not exceeding
   the withdrawable amount.
2. [`withdrawMax`](/reference/flow/contracts/contract.SablierFlow#withdrawmax): withdraws the entire withdrawable amount
   of tokens.

:::note

The `withdraw` functions requires a fee. Make sure to send the correct amount in `msg.value`, as shown below.

:::

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L51-L59`}
</CodeBlock>

## Adjust Rate per Second

Adjusting the rate per second means changing the amount of tokens that is streamed each second.

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L11-L13`}
</CodeBlock>

## Pause

Pausing a stream means setting the rate per second to zero, which means no more streaming.

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L23-L25`}
</CodeBlock>

## Restart

There are two restart functions:

1. [`restart`](/reference/flow/contracts/contract.SablierFlow#restart): restarts a stream.
2. [`restartAndDeposit`](/reference/flow/contracts/contract.SablierFlow#restartanddeposit): restarts a stream followed
   by depositing an amount of tokens into it.

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L39-L45`}
</CodeBlock>

## Refund

There are three refund functions:

1. [`refund`](/reference/flow/contracts/contract.SablierFlow#refund): refunds an amount of tokens not exceeding the
   refundable amount.
2. [`refundAndPause`](/reference/flow/contracts/contract.SablierFlow#refundandpause): refunds an amount of tokens, and
   then pauses the stream.
3. [`refundMax`](/reference/flow/contracts/contract.SablierFlow#refundmax): refunds the entire refundable amount of
   tokens.

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L27-L37`}
</CodeBlock>

## Void

Voiding a stream means permanently stopping it from streaming any tokens. This is slightly different from pausing a
stream because it also sets the stream's uncovered debt to zero.

<CodeBlock language="solidity" metastring={`reference title=""`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol#L47-L49`}
</CodeBlock>

## Full code

Below you can see the complete `FlowStreamManager` contract:

<CodeBlock language="solidity" showLineNumbers metastring={`reference title="Full code"`}>
  {`https://github.com/sablier-labs/evm-examples/blob/main/flow/FlowStreamManager.sol`}
</CodeBlock>
